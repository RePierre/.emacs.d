
* Org mode
  #+begin_src emacs-lisp
    (use-package org
      :ensure org-plus-contrib
      :config (progn
		(require 'ox-extra)
		(ox-extras-activate '(ignore-headlines))

		(require 'org-habit)
		(add-to-list 'org-modules 'org-habit)))
  #+end_src
** Setup =org-ref=
   As specified in [[https://github.com/jkitchin/org-ref/blob/master/org-ref.org][org-ref manual]].
   #+begin_src emacs-lisp
     (use-package org-ref
       :ensure t
       :init(progn
	      (defun my/org-ref-open-pdf-at-point ()
		"Open the pdf for bibtex key under point if it exists."
		(interactive)
		(let* ((results (org-ref-get-bibtex-key-and-file))
		       (key (car results))
		       (pdf-file (car (bibtex-completion-find-pdf key))))
		  (if (file-exists-p pdf-file)
		      (org-open-file pdf-file)
		    (message "No PDF found for %s" key))))

	      (setq reftex-default-bibliography '("~/org/bibliography/references.bib"))
	      ;; see org-ref for use of these variables
	      (setq org-ref-bibliography-notes "~/org/bibliography/notes.org"
		    org-ref-default-bibliography '("~/org/bibliography/references.bib")
		    org-ref-pdf-directory "~/org/bibliography/bibtex-pdfs/")

	      (setq bibtex-completion-bibliography "~/org/bibliography/references.bib"
		    bibtex-completion-library-path "~/org/bibliography/bibtex-pdfs"
		    bibtex-completion-notes-path "~/org/bibliography/helm-bibtex-notes")

	      (setq org-latex-pdf-process
		    '("pdflatex -interaction nonstopmode -output-directory %o %f"
		      "bibtex %b"
		      "pdflatex -interaction nonstopmode -output-directory %o %f"
		      "pdflatex -interaction nonstopmode -output-directory %o %f"))
	      (setq org-ref-open-pdf-function 'my/org-ref-open-pdf-at-point)
	      (require 'org-ref)))
   #+end_src
** Setup =org-cliplink=
   #+begin_src emacs-lisp
     (use-package org-cliplink
       :ensure t)
   #+end_src
** Automatically export to pdf
   #+begin_src emacs-lisp
     (defun is-beamer-presentation()
       (save-excursion
	 (goto-char (point-min))
	 (search-forward-regexp "#\\+latex_class:[[:blank:]]+beamer")))

     (defun export-to-pdf-async()
       (when (equal major-mode 'org-mode)
	 (if (is-beamer-presentation)
	     (progn
	       (message "Current buffer is beamer presentation. Automatic export will use org-beamer-export-to-pdf.")
	       (org-beamer-export-to-pdf t))
	   (progn
	     (message "Automatic export will use org-latex-export-to-pdf.")
	     (org-latex-export-to-pdf t)))))

     (defun toggle-export-to-pdf-async ()
       (interactive)
       (if (memq 'export-to-pdf-async after-save-hook)
	   (progn
	     (remove-hook 'after-save-hook 'export-to-pdf-async t)
	     (message "Disabled automatic export to pdf for current buffer."))
	 (add-hook 'after-save-hook 'export-to-pdf-async t t)
	 (message "Enabled automatic export to pdf for current buffer.")))
   #+end_src
** Automatically export to html
   #+begin_src emacs-lisp
     (defun rp/export-to-html-async()
       (when (equal major-mode 'org-mode)
	 (org-html-export-to-html t)))

     (defun rp/toggle-export-to-html-async()
       (interactive)
       (if (memq 'rp/export-to-html-async after-save-hook)
	   (progn
	     (remove-hook 'after-save-hook 'rp/export-to-html-async t)
	     (message "Disabled automatic export to HTML for current buffer."))
	 (progn
	   (add-hook 'after-save-hook 'rp/export-to-html-async t t)
	   (message "Enabled automatic export to HTML for current buffer."))))
   #+end_src
* Open GTD view
** Setup ~org-capture~
   #+BEGIN_SRC emacs-lisp
     (setq org-default-notes-file "~/org/notes.org")
     (global-set-key (kbd "C-c c") 'org-capture)
   #+END_SRC
** Setup ~org-capture-templates~
   #+BEGIN_SRC emacs-lisp
     (setq org-capture-templates
	   '(("t" "Todo [inbox]" entry (file+headline "~/org/gtd/inbox.org" "Inbox") "* TODO %i%?")
	     ("k" "Org-cliplink capture [inbox]" entry (file+headline "~/org/gtd/inbox.org" "Inbox") "* TODO %(org-cliplink-capture)")
	     ("j" "Journal Entry" entry (file+olp+datetree "~/org/journal.org") "* %?")
	     ("b" "Blog article idea" entry (file+headline "~/org/blogging.org" "Blog articles") "* IDEA %? \n %U")
	     ("T" "Tickler" entry (file+headline "~/org/gtd/tickler.org" "Tickler") "* %i%? \n %U")
	     ("w" "Work related items")
	     ("wa" "Work achievement" entry (file+olp+datetree "~/org/gtd/work.org") "* %?")
	     ("wf" "Technical feedback for a colleague" entry (file+olp+datetree "~/org/gtd/work.org" "Technical feedback") "* %?")
	     ("wt" "Todo item" entry (file+headline "~/org/gtd/work.org" "Work") "* TODO %? %(org-set-tags \"WORK\")")
	     ("wm" "Meeting" entry (file+headline "~/org/gtd/work.org" "Outlook") "* APPT %? %(org-set-tags \"WORK\")")
	     ("wr" "Retrospective remark" entry (file+headline "~/org/gtd/work.org" "Upcomming retrospective") "* TODO %? \n %U")
	     ("i" "Interruptions")
	     ("iw" "Work-related interruption" entry (file+headline "~/org/gtd/work.org" "Interruptions") "* %?" :clock-in t)
	     ("it" "Teaching-related interruption" entry (file+headline "~/org/teaching/2020/tap.org" "Orice Alte Chestiuni") "* %?" :clock-in t)))
   #+END_SRC
** Setup ~org-refile-targets~
   #+BEGIN_SRC emacs-lisp
     (setq org-refile-targets '(("~/org/gtd/gtd.org" :maxlevel . 3)
				("~/org/gtd/some-day.org" :level . 1)
				("~/org/gtd/tickler.org" :maxlevel . 2)
				("~/org/blogging.org" :level . 1)
				("~/org/gtd/work.org" :level . 1)
				("~/org/bibliography/reading-list.org" :maxlevel  . 2)
				("~/org/teaching/2020/tap.org" :level . 1)
				("~/org/rise-tv/rise-tv.org" :level . 1)
				("~/org/phd/phd.org" :level . 1)))
   #+END_SRC
  As found in this [[http://members.optusnet.com.au/~charles57/GTD/mydotemacs.txt][emacs init file]]. The full GTD workflow is explained int the [[http://members.optusnet.com.au/~charles57/GTD/gtd_workflow.html][blog post]].
  #+BEGIN_SRC emacs-lisp
    (add-hook 'org-agenda-mode-hook 'hl-line-mode)

    (defun gtd()
      (interactive)
      (progn
	(find-file "~/org/gtd/clock-report.org")
	(find-file "~/org/gtd/gtd.org")
	(org-agenda-list)))

    (global-set-key (kbd "C-c g") 'gtd)
  #+END_SRC
* Agenda
  #+BEGIN_SRC emacs-lisp
    (setq org-agenda-files
	  (quote ("~/org/gtd/inbox.org"
		  "~/org/gtd/gtd.org"
		  "~/org/gtd/work.org"
		  "~/org/gtd/some-day.org"
		  "~/org/gtd/tickler.org"
		  "~/org/bibliography/reading-list.org"
		  "~/org/blogging.org"
		  "~/org/teaching/2020/tap.org"
		  "~/org/phd/phd.org"
		  "~/org/rise-tv/rise-tv.org")))
    ;; (setq org-agenda-repeating-timestamp-show-all nil)
    (setq org-agenda-skip-deadline-if-done t)
    (setq org-agenda-skip-scheduled-if-done t)
  #+END_SRC
